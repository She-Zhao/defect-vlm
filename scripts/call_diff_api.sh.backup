#!/bin/bash
# è°ƒç”¨ä¸åŒå‚å•†çš„api

# --- é…ç½®åŒºåŸŸ ---
# å»ºè®®ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œé¿å…æ‰¾ä¸åˆ°æ–‡ä»¶
PROJECT_ROOT="/data/ZS/defect-vlm"
SCRIPT_PATH="$PROJECT_ROOT/defect_vlm/pe/call_api.py"
INPUT_FILE="/data/ZS/defect_dataset/4_api_request/test/012_pos400_neg300_rect300.jsonl"
OUTPUT_DIR="/data/ZS/defect_dataset/5_api_response/test"

# ç¡®ä¿è¾“å‡ºç›®å½•å­˜åœ¨
mkdir -p "$OUTPUT_DIR"

# æ¿€æ´»ç¯å¢ƒ (æ ¹æ®ä½ çš„å®é™…æƒ…å†µä¿®æ”¹ï¼Œå¦‚æœæ˜¯ conda)
# source /root/miniconda3/etc/profile.d/conda.sh
# conda activate defect-vlm

echo "========================================"
echo "ğŸš€ å¼€å§‹æ‰¹é‡æ‰“æ ‡ä»»åŠ¡"
echo "ğŸ“… å¼€å§‹æ—¶é—´: $(date)"
echo "ğŸ“‚ è¾“å…¥æ–‡ä»¶: $INPUT_FILE"
echo "========================================"

# --- ä»»åŠ¡åˆ—è¡¨ ---

# 1. Qwen3-VL-Plus
echo "ğŸ‘‰ Running Qwen3-VL-Plus..."
python "$SCRIPT_PATH" \
    --provider qwen \
    --model qwen3-vl-plus \
    --input_file "$INPUT_FILE" \
    --output_file "$OUTPUT_DIR/qwen3-vl-plus.jsonl" \
    --concurrency 3

# 2. Qwen3-VL-Instruct
echo "ğŸ‘‰ Running Qwen3-VL-Instruct..."
python "$SCRIPT_PATH" \
    --provider qwen \
    --model qwen3-vl-235b-a22b-instruct \
    --input_file "$INPUT_FILE" \
    --output_file "$OUTPUT_DIR/qwen3-vl-235b-a22b-instruct.jsonl" \
    --concurrency 3

# 3. Qwen3-VL-Thinking
echo "ğŸ‘‰ Running Qwen3-VL-Thinking..."
python "$SCRIPT_PATH" \
    --provider qwen \
    --model qwen3-vl-235b-a22b-thinking \
    --input_file "$INPUT_FILE" \
    --output_file "$OUTPUT_DIR/qwen3-vl-235b-a22b-thinking.jsonl" \
    --concurrency 3

# 4. Gemini-3-Pro
echo "ğŸ‘‰ Running Gemini-3-Pro..."
python "$SCRIPT_PATH" \
    --provider google \
    --model gemini-3-pro-preview \
    --input_file "$INPUT_FILE" \
    --output_file "$OUTPUT_DIR/gemini-3-pro-preview.jsonl" \
    --concurrency 3

# 5. GPT-5.2
echo "ğŸ‘‰ Running GPT-5.2..."
python "$SCRIPT_PATH" \
    --provider openai \
    --model gpt-5.2 \
    --input_file "$INPUT_FILE" \
    --output_file "$OUTPUT_DIR/gpt-5.2.jsonl" \
    --concurrency 3

# 6. GPT-5.1
echo "ğŸ‘‰ Running GPT-5.1..."
python "$SCRIPT_PATH" \
    --provider openai \
    --model gpt-5.1 \
    --input_file "$INPUT_FILE" \
    --output_file "$OUTPUT_DIR/gpt-5.1.jsonl" \
    --concurrency 5

echo "========================================"
echo "âœ… æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ"
echo "ğŸ“… ç»“æŸæ—¶é—´: $(date)"
echo "========================================"